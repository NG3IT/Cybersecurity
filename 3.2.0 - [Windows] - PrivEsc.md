# Methodology

1. Enumerate the current user's privileges and resources it can access

2. If the antivirus software allows it, run an automated enumeration script such as winPEAS or PowerUp.ps1

3. If the initial enumeration and scripts do not uncover an obvious strategy, try a different approach


---

# Enumeration

## Tools

1. WinPEAS -> enumerate the target system to uncover privilege escalation paths. (Windows Defender detects and disables WinPEAS

```powershell
$ winpeas.exe > result.txt
```

2. PowerUp -> PowerShell script that searches common privilege esacaltion on the target system. **Need to bypass the execution policy restrictions.**

```powershell
$ powershell.exe -nop -exec bypass
```

```powershell
$ Import-Mode PowerUp.ps1
$ Invoke-AllChecks
```

3. Windows Exploit Suggester -> Some exploit scripts will require you to upload them to the target system and run them there.

```powershell
# Update db
$ windows-exploit-suggester.py â€“update
```

```powershell
# Usage
$ windows-exploit-suggester.py --database <yyyy-mm-dd>-mssb.xls --systeminfo result.txt
```

4. Metasploit -> Some module can list vulnerabilities

```bash
multi/recon/local_exploit_suggester
```

## User enumeration

```powershell
# List current user's privileges
$ whoami /priv

# List users
$ net users

# Details about user
$ net user <user>
$ net user Administrator

# User(s) logged in simultaneously
$ qwinsta
$ query session

# List locals groups
$ net localgroup

# Details about group
$ net localgroup <groupname>
$ net localgroup Adlinistrators
```

## System information

```powershell
# Get informationsss
$ systeminfo

# OS Version
$ systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

# Hostanme 
$ hostname
```

## Search files

```powershell
# Find files with this pattern : password and .txt extension
findstr /si password *.txt

# Good extensions are : .txt, .xml, .ini, .config, .xls
```

## Patch level

```powershell
# Get patch applied on the system
$ wmic qfe get Caption,Description,HotFixID,InstalledOn
```

## Network connections

```powershell
# List all listened ports
$ netstat -ano
```

## Scheduled tasks

```powershell
# List all scheduled tasks
$ schtasks /query /fo LIST /v
```

## Drivers and applications

```powershell
# List all installed drivers
$ driverquery

# Dump information about installed software
$ wmic product
$ wmic product get name,version,vendor

# BETTER WAY
$ wmic service list brief

# Only running
$ wmic service list brief | findstr  "Running"

# Get more information about service
$ sc qc <service>
$ sc qc RemoteMouseService
```

## Antivirus

```powershell
# Check Windows Defender status
$ sc query windefend
$ Get-MpComputerStatus
$ (Get-Service windefend).Status
$ Get-Service | where {$_.DisplayName -Like "*Defender*"} | Select Status.DisplayName

# Check services (find any antivirus in this list)
$ sc queryex type=service
```
